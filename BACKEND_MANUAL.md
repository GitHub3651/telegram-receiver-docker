# Telegram 接码平台 - 详细维护手册

这份手册旨在帮助您全面掌握系统的使用与维护。我们将管理分为两部分：**网页端日常管理**（无需懂代码）和**服务器端深度维护**（需要 SSH）。

---

## 🖥️ 第一部分：网页端日常管理 (无需登录服务器)

日常的账号添加、验证码接收等操作，完全可以在浏览器中完成，无需进入黑底白字的命令行界面。

### 1. 访问管理后台
*   **地址**: `http://您的服务器IP`
*   **界面**: 您会看到“账号列表”和“最新验证码”两个主要区域。

### 2. 添加 Telegram 账号
这是最核心的功能，后端会自动处理复杂的登录流程。
1.  点击右上角的 **“+ 添加账号”** 按钮。
2.  **输入手机号**: 格式如 `+86 13800000000`，点击“发送验证码”。
3.  **输入验证码**: 查看您的手机或其它客户端，填入收到的 5 位验证码。
4.  **两步验证**: 如果账号设置了密码，请在“两步验证密码”栏填入；否则留空。
5.  点击“确认登录”，系统提示“登录成功”即完成。

### 3. 接收与检查验证码
*   **自动刷新**: 网页会自动拉取最新的验证码记录。
*   **手动检查**: 在账号列表中，点击对应账号后的 **“检查验证码”** 按钮。
    *   🟢 **绿色提示**: 成功获取到新验证码。
    *   🟡 **黄色提示**: 检查成功，但最近 30 分钟没有新码。
    *   🔴 **红色提示**: Session 失效（需要重新登录）或网络错误。

### 4. 账号管理
*   **删除账号**: 点击“删除”按钮，系统会从数据库和磁盘中彻底移除该账号的登录凭证。

---

## 📊 第二部分：后端日志详解 (读懂系统在干什么)

当您通过 SSH 进入服务器并运行 `docker-compose logs -f backend` 时，会看到大量刷屏的英文。别慌，以下是翻译对照表。

### 1. 典型日志示例解析

```text
# 1. 系统启动成功
2025-12-26 13:01:38 - INFO - Application startup complete.
2025-12-26 13:01:38 - INFO - Uvicorn running on http://0.0.0.0:8000...

# 2. 健康检查 (系统自动执行，忽略即可)
2025-12-26 13:01:42 - INFO - 127.0.0.1:43454 - "GET /api/health HTTP/1.1" 200

# 3. 网页端操作 (您在浏览器上的行为)
2025-12-26 13:01:53 - INFO - ... - "GET /api/accounts HTTP/1.1" 200  <-- 网页加载了账号列表
2025-12-26 13:01:53 - INFO - ... - "GET /api/codes... HTTP/1.1" 200    <-- 网页加载了验证码列表
2025-12-26 13:02:31 - INFO - ... - "POST /api/accounts/check/... 200   <-- 您点击了"检查验证码"按钮
```

### 2. 常见日志含义速查

| 关键词 | 含义 | 是否正常 |
| :--- | :--- | :--- |
| `Application startup complete` | 后端服务启动完毕，准备就绪 | ✅ 正常 |
| `GET /api/health` | Docker 正在检查服务是否活着 (每30秒一次) | ✅ 正常 |
| `GET /api/accounts` | 有人打开了网页，或者网页自动刷新了列表 | ✅ 正常 |
| `✅ 账号 xxx 登录成功` | 成功添加了一个新账号 | ✅ 正常 |
| `✅ Session 文件已保存` | 登录凭证已安全存入硬盘 | ✅ 正常 |
| `📅 下次保活任务将于...` | 自动任务调度器正在工作 | ✅ 正常 |
| `⚠️ 账号 xxx 未授权` | 该账号的登录状态失效了 (Session Invalid) | ❌ 需处理 |
| `ConnectionError` | 连接 Telegram 服务器失败 (通常是网络波动) | ❌ 需关注 |

---

## 🛠️ 第三部分：服务器运维指南 (SSH)

当网页端无法解决问题（如网站打不开、无法添加账号）时，需要使用这些命令。
**工作目录**: `/home/user128/telegram-receiver-docker`

### 1. 服务控制
*   **查看实时日志** (最常用):
    ```bash
    docker-compose logs -f backend
    ```
    *(按 `Ctrl + C` 退出查看)*

*   **重启服务**:
    ```bash
    docker-compose restart
    ```

*   **停止服务**:
    ```bash
    docker-compose down
    ```

### 2. 更新与修改
*   **修改代码后**: 如果您改了 Python 文件，必须重建：
    ```bash
    docker-compose up -d --build backend
    ```
*   **修改配置后**: 如果您改了 `.env` 文件，只需更新：
    ```bash
    docker-compose up -d
    ```

### 3. 数据备份
建议定期将 `sessions` 文件夹下载到本地备份。只要有这个文件夹，即使服务器重装，账号也不需要重新登录。

---

## ❓ 常见问题 (Q&A)

**Q: 为什么日志里一直有 `/api/health` 的记录？**
A: 这是 Docker 的健康检查机制，它每 30 秒问一次后端“你还活着吗？”，后端回答“200 OK”表示活着。这是正常的，说明系统很健康。

**Q: 网页上点击检查验证码，提示“Session 已失效”？**
A: 这意味着 Telegram 官方注销了该设备的登录状态（可能是因为异地登录风控）。请在网页上删除该账号，然后重新添加登录。

**Q: 如何让日志不显示那么多 INFO 信息？**
A: 目前设置为 INFO 级别是为了方便排查问题。如果觉得太吵，可以在代码中将日志级别改为 WARNING，但新手不建议这样做，因为出问题时会看不到细节。
